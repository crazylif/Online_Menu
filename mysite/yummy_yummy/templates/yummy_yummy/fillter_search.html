{% extends "yummy_yummy/base.html" %}

{% load static %}
{% block title %}Home{% endblock %}

{% block content %}
<body>
    <h1>Welcome to {{ shop_name }}</h1>

    {# DTL Logic: Checks if the user is authenticated #}
    {% if user.is_authenticated %}
        <p>Hello, {{ user.username }}! Here are the menu items:</p>
        {% if user.profile.usertype == 'user' or user.profile.usertype == 'admin' %}
            <br>
            <center>
                {% for row in allrow %}
                <br>
                <div class="row row-cols-1 row-cols-md-3 md-3 test-center">
                    {% for c in row %}
                    <div class="col">
                        <div class="card" style="width: 18rem;">
                        {% if c.picture %}
                        <img src="{{ c.picture.url }}" height="300" alt="picture" class="card-img-top">
                        {% endif %}
                        <div class="card-body">
                            <h5 class="card-title">{{ c.title }}</h5>
                            <p class="card-text">
                            price : {{ c.price }} à¸¿ <br>
                            description : {{ c.description }} <br>
                            available : {{ c.available }} <br>
                            by restaurant : {{ c.Restaurant.restaurant_name }}
                            </p>
                            <a href="#" class="btn btn-primary">more detail</a>
                        </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% endfor %}
            </center>
            <hr>
            <p>DEBUG: {{ allproduct }}</p>
            <p>Has next: {{ allproduct.has_next }}</p>
            <p>Has previous: {{ allproduct.has_previous }}</p>
            <p>Total pages: {{ allproduct.paginator.num_pages }}</p>

            <nav aria-label="...">
                <ul class="pagination">
                {% if allproduct.has_previous %}
                    <li class="page-item">
                    <a class="page-link" href="?page={{ allproduct.previous_page_number }}">Previous</a>
                    </li>

                    {% if allproduct.number|add:-2 > 0  %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{allproduct.number|add:-2}}">{{allproduct.number|add:-2}}</a>
                        </li>
                    {% endif %}

                    {% if allproduct.number > 1  %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{allproduct.number|add:-1}}">{{allproduct.number|add:-1}}</a>
                        </li>
                    {% endif %}

                    {% if allproduct.has_next != True %}
                        <li class="page-item active">
                        <a class="page-link" href="{{allproduct.number}}">{{allproduct.number}}</a>
                        </li>
                    {% endif %}

                {% endif %}  


                {% if allproduct.has_next %}
                    <li class="page-item active">
                    <a class="page-link" href="{{allproduct.number}}">{{allproduct.number}}</a>
                    </li>

                    {% if allproduct.paginator.num_pages > allproduct.number %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{allproduct.number|add:1}}">{{allproduct.number|add:1}}</a>
                    </li>
                    {% endif %}

                    {% if allproduct.paginator.num_pages > allproduct.number|add:1 %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{allproduct.number|add:2}}">{{allproduct.number|add:2}}</a>
                    </li>
                    {% endif %}

                    <li class="page-item">
                    <a class="page-link" href="?page={{allproduct.number|add:1}}">Next</a>
                    </li>
                {% endif %}

                </ul>
                <p> page {{allproduct.number}} from {{allproduct.paginator.num_pages}} </p>
            </nav>
        {% endif %}

    {% else %}
        <p>Please <a href="{% url 'login' %}">log in</a> to view the menu.</p>
    {% endif %}
</body>
{% endblock content %}
