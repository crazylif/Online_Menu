{% extends "yummy_yummy/base.html" %}

{% load static %}
{% block title %}Home{% endblock %}

{% block content %}
<body>
    <h1>Welcome to {{ shop_name }}</h1>

    {# DTL Logic: Checks if the user is authenticated #}
    {% if user.is_authenticated %}
        <p>Hello, {{ user.username }}! Here are the menu items:</p>
        {% if user.profile.usertype == 'seller' %}
        <p>You are the seller! <a href="{% url 'my-restaurant' res_id=my_restaurant.Restaurant_ID %}">Go to my restaurant</a></p>
        {% endif %}
        {% if user.profile.usertype == 'user' or user.profile.usertype == 'admin' %}
            <br>
            <center>
                {% for row in allrow %}
                <br>
                <div class="row row-cols-1 row-cols-md-3 md-3 test-center">
                    {% for c in row %}
                    <div class="col">
                        <div class="card" style="width: 18rem;">
                        {% if c.picture %}
                        <img src="{{ c.picture.url }}" height="300" alt="picture" class="card-img-top">
                        {% endif %}
                        <div class="card-body">
                            <h5 class="card-title">{{ c.title }}</h5>
                            <p class="card-text">
                            price : {{ c.price }} à¸¿ <br>
                            {% comment %} description : {{ c.description }} <br> {% endcomment %}
                            {% comment %} available : {{ c.available }} <br> {% endcomment %}
                            by restaurant : {{ c.Restaurant.restaurant_name }} | id : {{ c.Restaurant_id }}
                            </p>
                            <a href="#" class="btn btn-primary">more detail</a>
                            <a href="{% url 'add_to_cart' c.Product_ID %}" class="btn btn-success">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bag-plus" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M8 7.5a.5.5 0 0 1 .5.5v1.5H10a.5.5 0 0 1 0 1H8.5V12a.5.5 0 0 1-1 0v-1.5H6a.5.5 0 0 1 0-1h1.5V8a.5.5 0 0 1 .5-.5"/>
                                    <path d="M8 1a2.5 2.5 0 0 1 2.5 2.5V4h-5v-.5A2.5 2.5 0 0 1 8 1m3.5 3v-.5a3.5 3.5 0 1 0-7 0V4H1v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V4zM2 5h12v9a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1z"/>
                                </svg>
                                Add Cart
                            </a>
                        </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% endfor %}
            </center>
            <hr>
            <p>DEBUG: {{ allproduct }}</p>
            <p>Has next: {{ allproduct.has_next }}</p>
            <p>Has previous: {{ allproduct.has_previous }}</p>
            <p>Total pages: {{ allproduct.paginator.num_pages }}</p>

            <nav aria-label="...">
                <ul class="pagination">
                {% if allproduct.has_previous %}
                    <li class="page-item">
                    <a class="page-link" href="?page={{ allproduct.previous_page_number }}">Previous</a>
                    </li>

                    {% if allproduct.number|add:-2 > 0  %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{allproduct.number|add:-2}}">{{allproduct.number|add:-2}}</a>
                        </li>
                    {% endif %}

                    {% if allproduct.number > 1  %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{allproduct.number|add:-1}}">{{allproduct.number|add:-1}}</a>
                        </li>
                    {% endif %}

                    {% if allproduct.has_next != True %}
                        <li class="page-item active">
                        <a class="page-link" href="{{allproduct.number}}">{{allproduct.number}}</a>
                        </li>
                    {% endif %}

                {% endif %}  


                {% if allproduct.has_next %}
                    <li class="page-item active">
                    <a class="page-link" href="{{allproduct.number}}">{{allproduct.number}}</a>
                    </li>

                    {% if allproduct.paginator.num_pages > allproduct.number %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{allproduct.number|add:1}}">{{allproduct.number|add:1}}</a>
                    </li>
                    {% endif %}

                    {% if allproduct.paginator.num_pages > allproduct.number|add:1 %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{allproduct.number|add:2}}">{{allproduct.number|add:2}}</a>
                    </li>
                    {% endif %}

                    <li class="page-item">
                    <a class="page-link" href="?page={{allproduct.number|add:1}}">Next</a>
                    </li>
                {% endif %}

                </ul>
                <p> page {{allproduct.number}} from {{allproduct.paginator.num_pages}} </p>
            </nav>
        {% endif %}

    {% else %}
        <p>Please <a href="{% url 'login' %}">log in</a> to view the menu.</p>
    {% endif %}
</body>
{% endblock content %}
